<style type="text/css">
    .ctrls, a.curr-check, .theme-delete {
        position: absolute;
        background: white;
        border-radius: 3px;
        -webkit-border-radius: 3px;
        -moz-border-radius: 3px;
        padding: 5px
    }
    .ctrls {left: 0;}
    a.curr-check, .theme-delete {right: 0;}
    .theme-preview-img {
        overflow: hidden;
        height: 135px;
        margin: 4px
    }
    p.theme-name {
        padding: 7px;
        overflow: hidden;
        max-width: 170px;
    }
</style>
<div class="seotoaster container_12 h570 rounded3px refreshOnClose">
	<?php echo $this->partial('admin'.DIRECTORY_SEPARATOR.'_header.phtml', array('headerText' => 'Manage themes', 'helpSection' => $this->helpSection)); ?>

	<div  class="grid_12 mb10px">
		<fieldset>
		<div class="grid_5"><?php echo $this->toasterUploader(array(
						'id'=>'themes-uploader',
						'filters' => array('zip'),
						'caption' => $this->translate('Upload a new theme'),
						'caller' => 'themes'
						)); ?></div>
		<div class="grid_7">
			<div id="themes-uploader-filelist"></div>
		</div>
		</fieldset>
	</div>
	<div class="grid_12">
		<fieldset><legend>Themes list</legend>
			<div id="themes-list" class="h380">
			<?php foreach ($this->themesList as $theme) :?>


                <div class="themebox" style="position: relative;">
                    <a style="display: none;"   class="lnk-download ctrls" href="javascript:;" title="<?php echo ($this->translate('Download') . ' ' . $theme['name'] . ' ' . $this->translate('theme')); ?>"><img src="<?php echo $this->websiteUrl;?>system/images/download.png" /></a>

                    <?php if ($theme['isCurrent']): ?>
                        <a href="javascript:;" class="curr-check" title="this is the current theme"><img src="<?php echo $this->websiteUrl;?>system/images/current-theme.png"></a>
                    <?php else : ?>
                        <a style="display: none;" href="javascript:;" class="theme-delete" title="<?php echo $this->translate('trash this theme');?>"><img src="<?php echo $this->websiteUrl;?>system/images/delete.png"></a>
                    <?php endif; ?>
                    <div class="theme-preview-img">
                        <img src="<?php echo $theme['preview'];  ?>" class="preview" alt="<?php echo $theme['name']; ?>" />
                    </div>

                    <p class="theme-name">
                        <?php if (!$theme['isCurrent']): ?>
                            <input type="radio" name="select-theme" value="<?php echo $theme['name']; ?>"/>&nbsp;
                        <?php endif; ?>
                        <?php echo $theme['name']; ?>
                    </p>
                    <input type="hidden" class="theme-name" value="<?php echo $theme['name']; ?>"/>
                </div>

			<?php endforeach; ?>
			</div>
		</fieldset>
	</div>
	<div class="grid_12">
		<?php echo $this->formSubmit('done', $this->translate('Done')); ?>
	</div>
	<div class="clear"></div>
</div>

<script type="text/javascript">
$(function(){
	$('#themes-list').on('updateContent', function(){
		$(this).load('<?php echo $this->websiteUrl;?>backend/backend_theme/themes/ .themebox');
	});

	$('#themes-list').on('click', '.theme-delete', function(){
		var themeName = $(this).closest('div.themebox').find('input.theme-name').val();
		showConfirm('You are about to remove theme. Are you sure?', function() {
			$.ajax({
		        url: '<?php echo $this->url(array('action'=>'deletetheme')); ?>',
		        type: 'post',
			    beforeSend: function() {showSpinner();},
			    data: {name: themeName},
		        success: function(response) {
			        hideSpinner();
			        $('#themes-list').trigger('updateContent');
		        },
		        dataType: 'json'
		    });
		});
		return false;
	});

	$('#done').on('click', function(){
		if ($('input[name="select-theme"]:checked').size()){
			var themeName = $('input[name="select-theme"]:checked').val();
			$.post('<?php echo $this->url(array('action'=>'applytheme')); ?>',
			{'themename' : themeName},
			function(response){
				showMessage(response.responseText, response.error);
                $('#themes-list').trigger('updateContent');
			}, 'json');
		}
	});

	$('#themes-list').on('click', '.lnk-download', function(e) {
		var themeName = $(e.target).parents('.themebox').find('input.theme-name').val(); //$(this).prev().val();
		var url       = '<?php echo $this->websiteUrl;?>backend/backend_theme/downloadtheme/name/' + themeName;
		document.location.href = url;
	});

    $(document).on('mouseenter', '.themebox', function() {
        $(this).find('.ctrls, .theme-delete').fadeIn(100);
    }).on('mouseleave', '.themebox', function() {
        $(this).find('.ctrls, .theme-delete').hide();
    });
});
</script>

<script type="text/javascript">

/*    $('input[type=checkbox]').checked(function (e) {
        e.preventDefault();
        if ($(this).is(':checked')) {
            url = url + '/withoutBackup/true';
        }
    });*/

function update() {
    var url     = '<?php echo $this->websiteUrl ?>backend/backend_update/update';
    var $subBtn    = $("input[type=submit]");
    if ($('input[type=checkbox]').is(':checked')) {
            url = url + '/withoutBackup/true';
    }
    $subBtn.attr("disabled", "disabled");
    $.ajax({
        url : url,
        dataType: 'json',
        beforeSend : function() {showSpinner();},
        success: function(response) {
            hideSpinner();
            if(!response.error) {
                $("#progress").append('<li class="mb10px">' + response.responseText + '</li>');
                if (response.responseText === "Success") {
                    $subBtn.removeAttr("disabled");
                    return;
                }
                update();
            } else {
                $subBtn.removeAttr("disabled");
                $subBtn.val('Continue');
                showMessage(response.responseText, true);
            }
        },
        error: function(err) {
            showMessage(err, true);
        }
    });
}

$(function(){
    $('#update').submit(function(e) {
        e.preventDefault();
        update();
    })
});
</script>
<div class="seotoaster container_12 h450 rounded3px">
    <?php echo $this->partial('admin' . DIRECTORY_SEPARATOR . '_header.phtml', array('headerText' => 'Updater', 'helpSection' => $this->helpSection)); ?>
    <p class="grid_12 mb20px seo-tip">This is a beta version of the updater. Use at your own risk. You should create database dump before you start.</p>
    <p class="grid_6 mb20px" style="text-align: center;">Local toaster version: <?php echo $this->localVersion; ?></p>
    <p class="grid_6 mb20px" style="text-align: center;">Remote toaster version: <?php echo $this->remoteVersion; ?></p>
    <div class="grid_12 mb20px">
        <form id="update" action="<?php echo $this->websiteUrl ?>backend/backend_update/update" method="get">
            <div class="grid_6">Without backup: <input type ="checkbox" name="withoutBackup" value = "true"></div>
            <div class="grid_6"><input type="submit" name="update" value="<?php echo $this->translate('Update'); ?>"></div>
        </form>
    </div>
    <ul id="progress" class="seo-tip">
    </ul>

</div>

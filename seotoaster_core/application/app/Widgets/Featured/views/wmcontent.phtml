<form class="wmc-block" action="javascript:;" method="post">

	<label class="nopad grid_6" for="featured-item-type"><?php echo $this->translate('Type'); ?></label>
	<select class="nopad grid_6" id="featured-item-type">
		<option value="<?php echo Widgets_Featured_Featured::FEATURED_TYPE_AREA ;?>"><?php echo Widgets_Featured_Featured::FEATURED_TYPE_AREA ;?></option>
		<option value="<?php echo Widgets_Featured_Featured::FEATURED_TYPE_PAGE ;?>"><?php echo Widgets_Featured_Featured::FEATURED_TYPE_PAGE ;?></option>
	</select>

	<select class="nopad grid_12" id="featured-area-item"></select>

	<label class="nopad grid_6 max-res-row" id="fa-maxres-lbl" for="featured-item-maxres"><?php echo $this->translate('Max. result'); ?></label>
	<input class="nopad grid_6 max-res-row" type="text" id="featured-item-maxres" value="<?php echo Widgets_Featured_Featured::AREA_PAGES_COUNT; ?>" />

	<label class="nopad grid_6" for="featured-item-maxch"><?php echo $this->translate('Max. chars.'); ?></label>
	<input class="nopad grid_6" type="text" id="featured-item-maxch" value="<?php echo Widgets_Featured_Featured::AREA_DESC_LENGTH; ?>" />

	<label class="grid_6 nopad" for="featured-item-img"><?php echo $this->translate('Use image'); ?></label>
	<div class="grid_6 nopad">
		<input type="checkbox" id="featured-item-img" />
		<input class="cropped" type="checkbox" id="featured-item-img-crop" /><span class="nopad label cropped" style="display: inline;"><?php echo $this->translate('Cropped'); ?>?</span>
	</div>
	<label class="grid_6 nopad rand-row" for="featured-item-rand"><?php echo $this->translate('Random'); ?></label>
	<div class="grid_6 nopad rand-row">
		<input type="checkbox" id="featured-item-rand" />
	</div>

	<div class="grid_12"><input class="formsubmit" type="submit" id="fa-done" name="done" value="Done" /></div>
</form>
<script type="text/javascript">
	$(function() {
		$('.cropped').hide();

		loadData($('#featured-item-type').val());

		$('#featured-item-type').change(function() {
			$('.rand-row').toggle();
			$('.max-res-row').toggle();
			loadData($(this).val());
		});

		$('#featured-item-img').click(function() {
			$('#featured-item-img-crop').attr('checked', false);
			if($(this).attr('checked')) {
				$('.cropped').show();
			}
			else {
				$('.cropped').hide();
			}
		})

		$('#fa-done').click(function() {
			var imgType = '';
			if( $('#featured-item-img').attr('checked') && $('#featured-item-img-crop').attr('checked')) {
				imgType = ':imgc';
			}
			else if($('#featured-item-img').attr('checked') && !$('#featured-item-img-crop').attr('checked')) {
				imgType = ':img';
			}
			var featuredWidget = '{$featured:' + $('#featured-item-type').val() + ':' + $('#featured-area-item option:selected').val() + ':' +
									$('#featured-item-maxres').val() + ':' + $('#featured-item-maxch').val() +
									(imgType) +
									(($('#featured-item-rand').attr('checked')) ? ':random' : '') + '}';



			$('textarea.tinymce').tinymce().execCommand('mceInsertContent',false, featuredWidget);
		})
	});


	function loadData(type) {
		var websiteUrl = $('#website_url').val();
		var url = websiteUrl + 'backend/backend_featured/loadfalist/render/0/namesonly/1';
		if(type == 'page') {
			url = websiteUrl + 'backend/backend_page/listpages/';
		}
		$.getJSON(url, function(response) {
			$('#featured-area-item').find('option').remove().end();
			$.each(response.responseData, function() {
				var optVal  = (type == 'page') ? this.id : this.name;
				var optText = (type == 'page') ? this.h1 : this.name;
				$('#featured-area-item')
					.append($('<option></option>').attr({
						value: optVal
					})
					.text(optText));
			})
			if($('#featured-item-type').val() == 'page') {
				$('#featured-area-item').prepend('<option value="0" selected="selected">Select a page</option>')
			}
			else {
				$('#featured-area-item').prepend('<option value="Select a featured area" selected="selected">Select a featured area</option>');
			}
		})
	}
</script>